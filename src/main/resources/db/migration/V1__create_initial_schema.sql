CREATE TABLE category (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   name VARCHAR(255) NOT NULL,
   CONSTRAINT pk_category PRIMARY KEY (id)
);

CREATE TABLE product (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   name VARCHAR(255) NOT NULL,
   barcode VARCHAR(255) NOT NULL,
   measurement_unit INT NOT NULL,
   price DOUBLE PRECISION NOT NULL,
   stock DOUBLE PRECISION NOT NULL,
   category_id BIGINT NOT NULL,
   CONSTRAINT pk_product PRIMARY KEY (id)
);

ALTER TABLE product ADD CONSTRAINT FK_PRODUCT_ON_CATEGORY FOREIGN KEY (category_id) REFERENCES category (id);

CREATE TABLE customer (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   cpf VARCHAR(255) NOT NULL,
   first_name VARCHAR(255) NOT NULL,
   sur_name VARCHAR(255) NOT NULL,
   email VARCHAR(255) NOT NULL,
   password VARCHAR(255) NOT NULL,
   zipcode VARCHAR(255) NOT NULL,
   full_address VARCHAR(255) NOT NULL,
   CONSTRAINT pk_customer PRIMARY KEY (id)
);

ALTER TABLE customer ADD CONSTRAINT uc_customer_cpf UNIQUE (cpf);

ALTER TABLE customer ADD CONSTRAINT uc_customer_email UNIQUE (email);

CREATE TABLE order_item (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   product_id BIGINT,
   quantity DOUBLE PRECISION NOT NULL,
   sale_id BIGINT,
   CONSTRAINT pk_order_item PRIMARY KEY (id)
);

CREATE TABLE sale (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
   customer_id BIGINT,
   payment_options VARCHAR(255),
   total_price DOUBLE PRECISION,
   time TIMESTAMP WITHOUT TIME ZONE,
   CONSTRAINT pk_sale PRIMARY KEY (id)
);

ALTER TABLE sale ADD CONSTRAINT FK_SALE_ON_CUSTOMER FOREIGN KEY (customer_id) REFERENCES customer (id);

ALTER TABLE order_item ADD CONSTRAINT FK_ORDER_ITEM_ON_PRODUCT FOREIGN KEY (product_id) REFERENCES product (id);

ALTER TABLE order_item ADD CONSTRAINT FK_ORDER_ITEM_ON_SALE FOREIGN KEY (sale_id) REFERENCES sale (id);